if(!FPhi)var FPhi={};if(void 0===FPhi.Drawer){class Drawer{constructor(t,e,i,s,h){this.extractionMode=t,this.livenessMode=e,this.stabilizationStage=i,this.canvasSizeFactor=s,this.fontSizeFactor=h,this.buttonHeight=60*this.canvasSizeFactor,this.faceCenterOffset={x:0,y:0},this.faceCenterOffsetTarget={x:0,y:0},this.processingMoveProgressStartTime=.5,this.moveFace=null,this.moveLeftEye=null,this.moveRightEye=null,this.lastMoveFace=null,this.lastMoveLeftEye=null,this.lastMoveRightEye=null}cacheResources(){this.livenessMode==FPhi.Selphi.LivenessMode.Move&&(console.log("caching animations..."),this.cacheAnimation("LivenessMove","liveness_move"),this.cacheAnimation("LivenessMove","liveness_move_left"),this.cacheAnimation("LivenessMove","liveness_move_right"),this.cacheAnimation("LivenessMove","liveness_move_top"),this.cacheAnimation("LivenessMove","liveness_move_bottom"),this.cacheAnimation("LivenessInfo","livenessMoveGlasses"),this.cacheAnimation("LivenessInfo","livenessMoveInfo"))}setCanvasSize(t,e){this.width=t,this.height=e,this.landscape=this.width>=this.height,this.circleX=this.width/2,this.circleY=.38*this.height,this.circleRadius=.31*this.height,this.circleRadius>this.width/2-15&&(this.circleRadius=this.width/2-15)}getCameraRect(t,e,i,s){this.setCanvasSize(t.canvas.clientWidth,t.canvas.clientHeight);var h=this.scaleRect({width:e,height:i},{x:0,y:0,width:this.width,height:this.height});return h.visible=!0,h}faceInsideCircle(t){var e=this.circleRadius,i=this.circleX,s=this.circleY,h=i-e,a=i+e,r=s-e,o=s+e,l={x:t.x,y:t.y,width:t.width,height:t.height};return Math.max(0,Math.min(l.x+l.width,a)-Math.max(l.x,h))*Math.max(0,Math.min(l.y+l.height,o)-Math.max(l.y,r))/(l.width*l.height)>.75}getResourceIdForState(t){return"UCWaitingFaceStart"==t?"StartExtractor":"UCExtracting"==t||"UCLivenessDetectionStep1"==t||"UCLivenessDetectionStep2"==t||"UCLivenessDetectionStep3"==t||"UCWaitingEyeDetection"==t?"Extractor":"UCLivenessMoveStabilizing"==t||"UCLivenessMoveStabilized"==t||"UCLivenessMoveDetecting"==t||"UCLivenessMoveProcessing"==t?"LivenessMove":"UCLivenessMoveInfo"==t?"LivenessInfo":"UCTutorialRegister1"==t?"RegistrationTips":"UCTutorialRegister2"==t?"FaceMovementTips":"UCShowResults"==t?"Results":"UCWizardCompleted"==t?"Success":"UCTutorialBlink1"==t?"Tutorial1":"UCTutorialBlink2"==t?"Tutorial2":"UCTutorialBlink3"==t?"Tutorial3":"UCTutorialMove1"==t?"TutorialMove1":"UCTutorialMove2"==t?"TutorialMove2":"UCTutorialMove3"==t?"TutorialMove3":"UCWaitRecording"==t?"WaitRecording":"UCErrors"==t?"Error":null}onMouseMove(t,e,i,s,h){t.style.cursor="button"==h||"buttonImage"==h?"pointer":"default"}draw(t,e,i,s,h,a,r,o,l){if(t.imageSmoothingEnabled=!0,"background"==h)this.drawBackground(t,e,i,s,a,r,o,l);else if("button"==h)this.drawButton(t,e,i,s);else if("buttonImage"==h)this.drawButtonImage(t,e,i,s,a,r,o,l);else if("image"==h)this.drawImage(t,e,i,s,a,r,o,l);else if("imageError"==h)this.drawImageError(t,e,i,s,a,r,o,l);else if("text"==h)this.drawText(t,e,i,s,a,r,o,l);else if("faceSearcher"==h)this.drawFaceSearcher(t,e,i,s,a,r,o,l);else if("video"==h)"Extractor"==i?this.extractionMode==FPhi.Selphi.Mode.Register&&this.drawImageWithClippingCircle(t,e,l.player,e.x+e.width/2,e.y+e.height/2,e.width/2):this.drawImageWithClippingCircle(t,e,l.player,e.x+e.width/2,e.y+e.height/2,e.width/2);else if("camera"==h){var c=l.progress,n=this.rm.getSetupFloat("facephi-widget-conf","",this.landscape,"width_progress_bar"),g=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_progress_bar"),v=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_warning_message"),d=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_excellent"),m=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_low");t.save(),t.beginPath(),t.arc(this.circleX,this.circleY,this.circleRadius,0,2*Math.PI,!1),t.clip(),"UCLivenessMoveStabilizing"!=l.state&&"UCLivenessMoveStabilized"!=l.state&&"UCLivenessMoveDetecting"!=l.state&&"UCLivenessMoveProcessing"!=l.state||(t.fillStyle="#00000033",t.fillRect(e.x,e.y,e.width,e.height)),t.restore();var f=g;if("Warning"==o&&(f=v),0==c&&"Warning"==o&&(t.beginPath(),t.strokeStyle=m,t.lineWidth=n,t.lineCap="round",t.arc(this.circleX,this.circleY,this.circleRadius-t.lineWidth/2+.5,-Math.PI/2,2*Math.PI-Math.PI/2),t.stroke()),"UCLivenessMoveStabilizing"==l.state||"UCLivenessMoveStabilized"==l.state||"UCLivenessMoveDetecting"==l.state||"UCLivenessMoveProcessing"==l.state)c=1,f=l.liveness_move_last_result?d:m,"UCLivenessMoveDetecting"!=l.state&&"UCLivenessMoveProcessing"!=l.state||(t.beginPath(),t.strokeStyle=g,t.lineWidth=n,t.lineCap="round",t.arc(this.circleX,this.circleY,this.circleRadius-t.lineWidth/2+.5,-Math.PI/2,2*Math.PI-Math.PI/2),t.stroke());else{c>1&&(c=1),this.extractionMode==FPhi.Selphi.Mode.Authenticate&&(c=c*c*(3-2*c)),t.beginPath(),t.strokeStyle=f,t.lineWidth=n,t.lineCap="round",t.arc(this.circleX,this.circleY,this.circleRadius-t.lineWidth/2+.5,-Math.PI/2,2*Math.PI*c-Math.PI/2),t.stroke();var u=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_shutter");this.drawBlind(t,this.circleX,this.circleY,this.circleRadius,l.eyesYLevel,l.blind,u,l.blindText)}}else if("results"==h){var w=r/(1+1.5*l.progress);w>1&&(w=1),w=(w*=2-w)<.5?2*w*w:(4-2*w)*w-1,t.beginPath(),t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background_color"),t.arc(this.circleX,this.circleY,this.circleRadius,-Math.PI/2,2*Math.PI-Math.PI/2),t.fill();var _=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_excellent");l.progress<=.33?_=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_low"):l.progress<=.66&&(_=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_good")),t.beginPath(),t.strokeStyle=_,t.lineWidth=this.rm.getSetupFloat("facephi-widget-conf","",this.landscape,"width_progress_bar"),t.lineCap="round",t.arc(this.circleX,this.circleY,this.circleRadius-t.lineWidth/2*.5,-Math.PI/2,2*Math.PI*l.progress*w-Math.PI/2),t.stroke();var p="",y="";l.progress>=1?(p=this.rm.translate("results_quality_excellent"),y=this.rm.translate("results_quality_message")):l.progress>=.333?(p=this.rm.translate("results_quality_good"),y=this.rm.translate("results_quality_message")):(p=this.rm.translate("results_quality_low"),y=this.rm.translate("results_quality_message"));var F=this.rm.getSetupFloat(i,s,this.landscape,"fontResult_size"),x=F+1,R=this.rm.getSetupResourceId(i,s,this.landscape,"fontResult"),b="CENTER",S="TOP";this.drawStringMultiline(t,p,{x:0,y:this.circleY-5,width:this.width,height:this.height},_,R,F,x,b,S);x=(F=this.rm.getSetupFloat(i,s,this.landscape,"fontQuality_size"))+1;R=this.rm.getSetupResourceId(i,s,this.landscape,"fontQuality");b="CENTER",S="TOP";this.drawStringMultiline(t,y,{x:0,y:this.circleY+5+F,width:this.width,height:this.height},_,R,F,x,b,S)}else if("animation"==h){var M=0;"livenessMoveDirection"in l&&(M=l.livenessMoveDirection),"liveness_move"!=s&&(M=0),this.drawAnimation(t,e,i,s,a,r,o,l,M)}else"progress"==s&&(t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background_color"),t.fillRect(e.x,e.y,e.width,e.height),t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"progress_color"),t.fillRect(e.x,e.y,e.width*l.progress,e.height))}getLayout(t,e,i,s,h,a,r){if("Tutorial1"==t||"Tutorial2"==t||"Tutorial3"==t||"TutorialMove1"==t||"TutorialMove2"==t||"TutorialMove3"==t){if("background"==e)return{x:0,y:0,width:this.width,height:this.height};if("video"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("tip"==e)return{x:0,y:.75*this.height,width:this.width,height:.1*this.height};if("tip_detail"==e)return{x:0,y:.82*this.height,width:this.width,height:.1*this.height};if("button_skip"==e)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_back"==e)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_next"==e)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_done"==e)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_exit"==e){var o=this.rm.getSetupResourceId(t,e,this.landscape,"value"),l=this.rm.getImage(o),c=this.canvasSizeFactor*this.rm.getImageScale(),n=l.width*c,g=l.height*c;return{x:this.width-n-30,y:0,width:n+30,height:g+30}}if("liveness_move"==e)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else{if("background"==e)return{x:0,y:0,width:this.width,height:this.height};if("tip_video"==e)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("imageError"==e)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("video_success"==e)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("extraction_video"==e)return{x:this.width/2-.1*this.width,y:.73*this.height,width:.2*this.width,height:.2*this.width};if("tip"==e)return{x:0,y:.75*this.height,width:this.width,height:.1*this.height};if("text_error"==e)return{x:0,y:.75*this.height,width:this.width,height:.1*this.height};if("text"==e)return{x:0,y:this.circleY+this.circleRadius,width:this.width,height:this.height-this.buttonHeight-10-(this.circleY+this.circleRadius)};if("tip_detail"==e)return{x:0,y:.82*this.height,width:this.width,height:.1*this.height};if("button_skip"==e)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_next"==e)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_done"==e)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_start"==e){let t=209*this.canvasSizeFactor;return{x:this.width/2-t/2,y:this.height-this.buttonHeight+10,width:t,height:this.buttonHeight-10}}if("button_error"==e)return{x:this.width/4,y:this.height-this.buttonHeight+10,width:this.width/2,height:this.buttonHeight-10};if("button_back"==e)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_repeat"==e)return{x:.05*this.width,y:this.height-this.buttonHeight,width:.4*this.width,height:this.buttonHeight};if("button_finish"==e)return{x:.55*this.width,y:this.height-this.buttonHeight,width:.4*this.width,height:this.buttonHeight};if("button_exit"==e){o=this.rm.getSetupResourceId(t,e,this.landscape,"value"),l=this.rm.getImage(o),c=this.canvasSizeFactor*this.rm.getImageScale(),n=l.width*c,g=l.height*c;return{x:this.width-n-30,y:0,width:n+30,height:g+30}}if("button_info"==e){if(this.extractionMode==FPhi.Selphi.Mode.Register||this.livenessMode!=FPhi.Selphi.LivenessMode.None){o=this.rm.getSetupResourceId(t,e,this.landscape,"value"),l=this.rm.getImage(o),c=this.canvasSizeFactor*this.rm.getImageScale();return{x:0,y:0,width:(n=l.width*c)+30,height:(g=l.height*c)+30}}}else{if("warning"==e)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("warningTooFar"==e)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("camera"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("results"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("liveness_move_text"==e)return"UCLivenessMoveProcessing"==r.state&&h<.5?null:{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("liveness_move_tip_text"==e)return{x:this.circleX-this.circleRadius,y:this.circleY-.39*this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("livenessInfo_text"==e)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("liveness_move"==e){if("UCLivenessMoveDetecting"==r.state&&h>=.25&&h<1.75){var v=!1;return this.rm.isAttributeAvailable(t,e,this.landscape,"fullscreen")&&"true"==this.rm.getSetupResourceId(t,e,this.landscape,"fullscreen")&&(v=!0),v?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}return null}if("liveness_move_left"==e||"liveness_move_right"==e||"liveness_move_top"==e||"liveness_move_bottom"==e){if("UCLivenessMoveDetecting"==r.state&&h>=.25&&h<1.75){if(0==r.livenessMoveDirection&&"liveness_move_top"!=e)return null;if(2==r.livenessMoveDirection&&"liveness_move_bottom"!=e)return null;if(1==r.livenessMoveDirection&&"liveness_move_right"!=e)return null;if(3==r.livenessMoveDirection&&"liveness_move_left"!=e)return null;v=!1;return this.rm.isAttributeAvailable(t,e,this.landscape,"fullscreen")&&"true"==this.rm.getSetupResourceId(t,e,this.landscape,"fullscreen")&&(v=!0),v?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}return null}if("face_searcher"==e)return{x:0,y:0,width:this.width,height:this.height};if("livenessMoveGlasses"==e){if(0==r.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("livenessMoveInfo"==e){if(1==r.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("progress"==e&&"UCLivenessMoveProcessing"==r.state&&h>this.processingMoveProgressStartTime)return{x:this.circleX-this.circleRadius,y:.8*this.height,width:2*this.circleRadius,height:19}}}return null}drawBackground(t,e,i,s,h,a,r,o){t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"top"),t.fillRect(e.x,e.y,e.width,this.circleY-this.circleRadius+1),"true"==this.rm.getSetupResourceId(i,s,this.landscape,"clipped").toLowerCase()&&(t.save(),t.beginPath(),t.arc(this.circleX,this.circleY,this.circleRadius,0,2*Math.PI,!1),t.rect(0,0,this.width,this.height),t.clip("evenodd")),t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"middle_top"),t.fillRect(e.x,this.circleY-this.circleRadius,e.width,2*this.circleRadius+1),"true"==this.rm.getSetupResourceId(i,s,this.landscape,"clipped").toLowerCase()&&t.restore(),t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"middle_bottom"),t.fillRect(e.x,this.circleY+this.circleRadius,e.width,this.height-this.buttonHeight-(this.circleY+this.circleRadius)+1),t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"bottom"),t.fillRect(e.x,this.height-this.buttonHeight,e.width,this.buttonHeight);var l=this.rm.getSetupColor(i,s,this.landscape,"pagination_separator");null!=l&&(t.fillStyle=l,t.fillRect(0,this.height-this.buttonHeight-1,e.width,1))}drawPoint(t,e,i,s,h){t.fillStyle=h,t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.fill()}drawLine(t,e,i,s,h,a){t.lineWidth=1,t.strokeStyle=a,t.beginPath(),t.moveTo(e,i),t.lineTo(s,h),t.stroke()}drawFaceSearcher(t,e,i,s,h,a,r,o){o.progress;var l=o.leftEyeData,c=o.rightEyeData,n=o.faceDataRect;n&&(this.lastMoveFace=n,null==this.moveFace&&(this.moveFace=this.lastMoveFace)),l&&(this.lastMoveLeftEye=l,null==this.moveLeftEye&&(this.moveLeftEye=this.lastMoveLeftEye)),c&&(this.lastMoveRightEye=c,null==this.moveRightEye&&(this.moveRightEye=this.lastMoveRightEye)),this.moveFace&&(this.moveFace.x+=.1*(this.lastMoveFace.x-this.moveFace.x),this.moveFace.y+=.1*(this.lastMoveFace.y-this.moveFace.y),this.moveFace.width+=.1*(this.lastMoveFace.width-this.moveFace.width),this.moveFace.height+=.1*(this.lastMoveFace.height-this.moveFace.height)),this.moveLeftEye&&(this.moveLeftEye.x+=.15*(this.lastMoveLeftEye.x-this.moveLeftEye.x),this.moveLeftEye.y+=.15*(this.lastMoveLeftEye.y-this.moveLeftEye.y),this.drawPoint(t,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,2,"#ffffff"),this.drawPoint(t,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,2,"#ffffff"),this.drawPoint(t,this.moveLeftEye.x-.02*this.width,this.moveLeftEye.y-.05*this.height,2,"#ffffff"),this.drawLine(t,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,"#ffffff"),this.drawLine(t,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,this.moveLeftEye.x-.02*this.width,this.moveLeftEye.y-.05*this.height,"#ffffff"),this.drawLine(t,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,this.moveLeftEye.x-.02*this.width,this.moveLeftEye.y-.05*this.height,"#ffffff"),this.moveFace&&(this.drawLine(t,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2-.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2-.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2-.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2-.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff"))),this.moveRightEye&&(this.moveRightEye.x+=.15*(this.lastMoveRightEye.x-this.moveRightEye.x),this.moveRightEye.y+=.15*(this.lastMoveRightEye.y-this.moveRightEye.y),this.drawPoint(t,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,2,"#ffffff"),this.drawPoint(t,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,2,"#ffffff"),this.drawPoint(t,this.moveRightEye.x+.02*this.width,this.moveRightEye.y-.05*this.height,2,"#ffffff"),this.drawLine(t,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,"#ffffff"),this.drawLine(t,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,this.moveRightEye.x+.02*this.width,this.moveRightEye.y-.05*this.height,"#ffffff"),this.drawLine(t,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,this.moveRightEye.x+.02*this.width,this.moveRightEye.y-.05*this.height,"#ffffff"),this.moveFace&&(this.drawLine(t,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2+.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2+.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2+.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(t,this.moveFace.x+this.moveFace.width/2+.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff")))}drawButtonImage(t,e,i,s,h,a,r,o){var l=this.rm.getSetupResourceId(i,s,this.landscape,"value"),c=this.rm.getImage(l),n=this.canvasSizeFactor*this.rm.getImageScale(),g=c.width*n,v=c.height*n;t.drawImage(c,e.x+e.width/2-g/2,e.y+e.height/2-v/2,g,v)}drawButton(t,e,i,s){t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"decorator"),t.fillRect(e.x,e.y+4,e.width,e.height-4),t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background"),t.fillRect(e.x,e.y,e.width,e.height-4);var h=this.rm.getSetupAlign(i,s,this.landscape,"align"),a=this.rm.getSetupNodeType(i,s),r=10*this.canvasSizeFactor;if("TEXT_ID"==a){var o=this.rm.getSetupTextId(i,s,this.landscape,"content"),l=this.rm.translate(o),c=this.rm.getSetupFloat(i,s,this.landscape,"font_size");c=Math.round(c*this.fontSizeFactor);var n=this.rm.getSetupResourceId(i,s,this.landscape,"font");t.font=c+"px '"+n+"'",t.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"foreground");var g=t.measureText(l);"LEFT"==h?t.fillText(l,e.x+r,e.y+e.height/2):"RIGHT"==h?t.fillText(l,e.x+e.width-g.width-r,e.y+e.height/2):t.fillText(l,e.x+e.width/2-g.width/2,e.y+e.height/2)}else{o=this.rm.getSetupResourceId(i,s,this.landscape,"content");var v=this.rm.getImage(o),d=this.canvasSizeFactor*this.rm.getImageScale();"LEFT"==h?t.drawImage(v,e.x+r,e.y+e.height/2-v.height*d/2,v.width*d,v.height*d):"RIGHT"==h?t.drawImage(v,e.x+e.width-v.width*d-r,e.y+e.height/2-v.height*d/2,v.width*d,v.height*d):t.drawImage(v,e.x+e.width/2-v.width*d/2,e.y+e.height/2-v.height*d/2,v.width*d,v.height*d)}}drawImage(t,e,i,s,h,a,r,o){var l=this.rm.getSetupResourceId(i,s,this.landscape,"value"),c=this.rm.getImage(l),n=this.canvasSizeFactor*this.rm.getImageScale(),g=c.width*n,v=c.height*n;t.drawImage(c,e.x+e.width/2-g/2,e.y+e.height/2-v/2,g,v)}drawImageError(t,e,i,s,h,a,r,o){var l=this.rm.getImage("livenessError.png");switch(o.livenessDiagnostic){case-1:l=this.rm.getImage("timeout.png");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessLowPerformance:l=this.rm.getImage("livenessPerformance.png");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessGlasses:l=this.rm.getImage("livenessGlasses.png");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessLight:l=this.rm.getImage("livenessLights.png")}this.canvasSizeFactor,this.rm.getImageScale(),l.width,l.height;var c=this.scaleRect({width:l.width,height:l.height},e);t.drawImage(l,c.x,c.y,c.width,c.height)}drawImageWithClippingCircle(t,e,i,s,h,a){t.save(),t.beginPath(),t.arc(s,h,a,0,2*Math.PI,!1),t.clip(),t.drawImage(i,e.x,e.y,e.width,e.height),t.restore()}cacheAnimation(t,e){if(this.rm.isAttributeAvailable(t,e,this.landscape,"id"))for(var i=this.rm.getSetupResourceId(t,e,this.landscape,"name"),s=this.rm.getSetupResourceId(t,e,this.landscape,"ext"),h=parseInt(this.rm.getSetupResourceId(t,e,this.landscape,"start")),a=parseInt(this.rm.getSetupResourceId(t,e,this.landscape,"end")),r=h;r<=a;r++){var o=i+("0"+r).slice(-2)+"."+s;this.rm.getImage(o)}}drawAnimation(t,e,i,s,h,a,r,o,l){var c=a;switch((c/=2)>1&&(c=1),"videoProgress"in o&&(c=o.videoProgress),t.save(),t.translate(e.x+e.width/2,e.y+e.height/2),l){case 1:t.rotate(3*-Math.PI/2);break;case 2:t.rotate(Math.PI);break;case 3:t.rotate(1*-Math.PI/2)}t.translate(-(e.x+e.width/2),-(e.y+e.height/2));var n=this.rm.getSetupResourceId(i,s,this.landscape,"name"),g=this.rm.getSetupResourceId(i,s,this.landscape,"ext"),v=parseInt(this.rm.getSetupResourceId(i,s,this.landscape,"start")),d=parseInt(this.rm.getSetupResourceId(i,s,this.landscape,"end")),m=n+("0"+Math.floor((d-v)*c+v)).slice(-2)+"."+g,f=this.rm.getImage(m);t.drawImage(f,e.x,e.y,e.width,e.height),t.restore()}drawText(t,e,i,s,h,a,r,o){var l=this.rm.getSetupFloat(i,s,this.landscape,"font_size"),c=l+1;this.rm.isAttributeAvailable(i,s,this.landscape,"line_height")&&(c=this.rm.getSetupFloat(i,s,this.landscape,"line_height"));var n=this.rm.getSetupColor(i,s,this.landscape,"color"),g=this.rm.getSetupResourceId(i,s,this.landscape,"font"),v="CENTER";this.rm.isAttributeAvailable(i,s,this.landscape,"align")&&(v=this.rm.getSetupAlign(i,s,this.landscape,"align"));var d="TOP";this.rm.isAttributeAvailable(i,s,this.landscape,"valign")&&(d=this.rm.getSetupAlign(i,s,this.landscape,"valign"));var m="";if("Tutorial1"==i)m="tip"==s?this.rm.translate("tutorial1_tip"):this.rm.translate("tutorial1_tip_detail");else if("Tutorial2"==i)m="tip"==s?this.rm.translate("tutorial2_tip"):this.rm.translate("tutorial2_tip_detail");else if("Tutorial3"==i)m="tip"==s?this.rm.translate("tutorial3_tip"):this.rm.translate("tutorial3_tip_detail");else if("TutorialMove1"==i)m="tip"==s?this.rm.translate("tutorialMove1_tip"):this.rm.translate("tutorialMove1_tip_detail");else if("TutorialMove2"==i)m="tip"==s?this.rm.translate("tutorialMove2_tip"):this.rm.translate("tutorialMove2_tip_detail");else if("TutorialMove3"==i)m="tip"==s?this.rm.translate("tutorialMove3_tip"):this.rm.translate("tutorialMove3_tip_detail");else if("RegistrationTips"==i)m="tip"==s?this.rm.translate("registration_tips_title"):this.rm.translate("registration_tips_detail");else if("FaceMovementTips"==i)m="tip"==s?this.rm.translate("face_movement_tips_title"):this.rm.translate("face_movement_tips_detail");else if("StartExtractor"==i)"text"==s&&(m=this.rm.translate("start_extractor_title"));else if("Extractor"==i)"warning"==s&&(m=this.rm.translate("error_message_face")),this.extractionMode!=FPhi.Selphi.Mode.Register&&"text"==s&&(m=this.rm.translate("start_extractor_title"));else if("LivenessMove"==i){if("liveness_move_text"==s)if("UCLivenessMoveStabilizing"==o.state||"UCLivenessMoveStabilized"==o.state)m=this.rm.translate("extracting_title");else if("UCLivenessMoveDetecting"==o.state){switch(o.livenessMoveDirection){case 0:m=this.rm.translate("liveness_move_tip_up");break;case 1:m=this.rm.translate("liveness_move_tip_right");break;case 2:m=this.rm.translate("liveness_move_tip_down");break;case 3:m=this.rm.translate("liveness_move_tip_left")}}else"UCLivenessMoveProcessing"==o.state&&(m=this.rm.translate("liveness_move_processing"));else if("warning"==s&&("UCLivenessMoveStabilizing"==o.state||"UCLivenessMoveStabilized"==o.state))switch(o.livenessMoveLastStabilizedStatus){case 1:m=this.rm.translate("liveness_move_stabilizing_ok");break;case 2:m=this.rm.translate("liveness_move_stabilizing_not_stabilized");break;case 3:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_too_far");break;case 4:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_sun_glasses");break;case 5:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_too_close");break;case 6:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_too_movement");break;case 7:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_performance");break;case 8:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal");break;case 9:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_left");break;case 10:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_right");break;case 11:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_down");break;case 12:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_up");break;case 13:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_color");break;case 14:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_quality");break;case 15:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_face_quality");break;case 16:m=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_pattern_quality");break;case 17:m=this.rm.translate("liveness_move_stabilizing_ok_glasses");break;default:m=this.rm.translate("extracting_title")}}else if("LivenessInfo"==i)"livenessInfo_text"==s&&(m=0==o.livenessMoveFailReason?this.rm.translate("liveness_move_info_sunglasses"):this.rm.translate("liveness_move_info_unsuccess"));else if("Results"==i){if("tip"==s){if(a<1)n="#00000000";else if(a>=1){var f=2*(a-1);f>1&&(f=1),n=this.rm.getSetupColorWithAlpha(i,s,this.landscape,"color",f)}m=o.progress>=1?this.rm.translate("results_message_excellent"):o.progress>=.333?this.rm.translate("results_message_good"):this.rm.translate("results_message_low")}}else if("Error"==i&&"text_error"==s)switch(o.livenessDiagnostic){case-1:m=this.rm.translate("timeout");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessLowPerformance:m=this.rm.translate("livenessErrorPerformance");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessGlasses:m=this.rm.translate("livenessErrorGlasses");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessLight:m=this.rm.translate("livenessErrorDark");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessNoMovement:m=this.rm.translate("livenessErrorNoMovement");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessWrongDirection:m=this.rm.translate("livenessErrorWrongDirection");break;case FPhi.Selphi.LivenessDiagnostic.UnsuccessTooFar:m=this.rm.translate("livenessErrorTooFar");break;default:m=this.rm.translate("livenessMoveError")}this.drawStringMultiline(t,m,e,n,g,l,c,v,d)}drawStringMultiline(t,e,i,s,h,a,r,o,l){var c=e.split("\n");t.imageSmoothingEnabled=!1,a=Math.round(a*this.fontSizeFactor),t.font=a+"px '"+h+"'",t.fillStyle=s,t.textBaseline="middle";var n=i.y;if("CENTER"==l){var g=c.length*r;n=i.y+i.height/2-g/2+a/2}else if("BOTTOM"==l){g=c.length*r;n=i.y+i.height-g}for(var v=0;v<c.length;v++){var d=t.measureText(c[v]),m=i.width/2-d.width/2;"LEFT"==o?m=0:"RIGHT"==o&&(m=i.width-d.width),t.fillText(c[v],i.x+m,n+v*r)}}drawBlind(t,e,i,s,h,a,r,o){var l=(h-i)/s*.5+.5,c=2*s*l,n=2*s*(1-l);t.save(),t.beginPath(),t.arc(e,i,s,0,2*Math.PI,!1),t.clip(),t.fillStyle=r,t.fillRect(e-s,i-s,2*s,c*a),t.fillRect(e-s,i+s-n+n*(1-a),2*s,n*a),t.restore();var g=this.rm.getSetupResourceId("facephi-widget-conf","",this.landscape,"font_shutter_text");t.fillStyle=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_shutter_text"),t.font=26*this.fontSizeFactor+"px '"+g+"'";var v=t.measureText(o);t.fillText(o,e-v.width/2,i+s-n+n*(1-a)+30)}scaleRect(t,e,i){var s=e.x+e.width/2,h=e.y+e.height/2,a=e.width/t.width,r=e.height/t.height,o=t.width*a,l=t.height*a;return void 0==i?l<e.height&&(o=t.width*r,l=t.height*r):l>=e.height&&(o=t.width*r,l=t.height*r),{x:s-o/2,y:h-l/2,width:o,height:l}}}FPhi.Drawer=Drawer}