if(!FPhi)var FPhi={};class Tutorial{constructor(e,t,i,s,a,n,h,r){this.container=e,this.width=t,this.height=i,this.onFinish=s,this.onUserCancel=a,this.language=n,this.rmPath=h,this.dpiList=r,this.rmLoaded=!1,this.running=!1,this.canvasSizeFactor=this.height/500,this.fontSizeFactor=this.height/500,this.buttonHeight=50*this.canvasSizeFactor,this.circleX=this.width/2,this.circleY=.38*this.height,this.circleRadius=.31*this.height,this.debug=!1,this.onFinish=s,this.onUserCancel=a,this.graphReady=!1,this.tipText=null,this.tipTextSize=null,this.tipTextColor=null,this.tipFont=null,this.tipDetailText=null,this.tipDetailTextSize=null,this.tipDetailTextColor=null,this.tipDetailFont=null,this.path=this.getScriptPath("FPhi.Widget.tutorial.wasm.js");var l=document.createElement("script");l.type="text/javascript",l.src=this.path+"FPhi.Widget.rm.wasm.js",l.onreadystatechange=this.OnResourceManagerLoaded.bind(this),l.onload=this.OnResourceManagerLoaded.bind(this),document.getElementsByTagName("head")[0].appendChild(l);var o=document.createElement("script");o.type="text/javascript",o.src=this.path+"FPhi.Widget.graph.wasm.js",o.onreadystatechange=this.OnGraphLoaded.bind(this),o.onload=this.OnGraphLoaded.bind(this),document.getElementsByTagName("head")[0].appendChild(o);var d=document.createElement("script");d.type="text/javascript",d.src=this.path+"FPhi.Widget.drawer.wasm.js",d.onload=this.OnDrawerLoaded.bind(this),document.getElementsByTagName("head")[0].appendChild(d);var c=document.getElementById(e),u="<canvas id='fphiTutorialDisplay' width='"+this.width+"' height='"+this.height+"'/>";c.innerHTML=u,this.canvas=document.getElementById("fphiTutorialDisplay"),this.canvas.style.display="inline-block",this.canvas.addEventListener("click",this.canvasOnClick.bind(this),!1),this.canvas.addEventListener("mousemove",this.canvasOnMove.bind(this),!1)}canvasOnClick(e){if(void 0!=this.elements)for(var t=this.elements.length-1;t>=0;t--)if(void 0!=this.elements[t].layout&&e.offsetX>=this.elements[t].layout.x&&e.offsetX<this.elements[t].layout.x+this.elements[t].layout.width&&e.offsetY>=this.elements[t].layout.y&&e.offsetY<this.elements[t].layout.y+this.elements[t].layout.height){var i="Click//"+this.elements[t].id;this.graph.sendMessage(i);break}}canvasOnMove(e){for(var t=this.elements.length-1;t>=0;t--)if(void 0!=this.elements[t].layout&&e.offsetX>=this.elements[t].layout.x&&e.offsetX<this.elements[t].layout.x+this.elements[t].layout.width&&e.offsetY>=this.elements[t].layout.y&&e.offsetY<this.elements[t].layout.y+this.elements[t].layout.height){this.drawer.onMouseMove(e.target,this.elements[t].layout,this.resourceParent,this.elements[t].id,this.elements[t].type);break}}OnResourceManagerLoaded(e){this.rm=new FPhi.ResourceManager(this.rmPath,this.language,this,this.OnResourceManagerStatus,this.dpiList,window.devicePixelRatio,this.canvasSizeFactor)}OnResourceManagerStatus(e,t){t&&(e.rmLoaded=!0,e.CheckDependencies(e))}OnGraphLoaded(e){this.graph=new FPhi.Graph(this.path+"graph.xml",this.OnGraphReady.bind(this),this.OnGraphNewState.bind(this))}OnGraphReady(e){this.graphReady=!0,this.CheckDependencies(this)}OnDrawerLoaded(e){this.drawer=new FPhi.Drawer(null,null,this.canvasSizeFactor,this.fontSizeFactor),this.CheckDependencies(this)}CheckDependencies(e){e.rmLoaded&&void 0!==e.drawer&&void 0!==e.graph&&1!=e.running&&1==e.graphReady&&(e.running=!0,e.drawer.rm=e.rm,e.drawer.setCanvasSize(e.width,e.height),e.graph.setInitialState("Tutorial1"),e.draw(e))}OnGraphNewState(e){"TutorialFinish"==e?this.onFinish():"TutorialCancelByUser"==e?this.onUserCancel():(this.resourceParent=e,this.elements=this.rm.getElements(this.resourceParent),this.startVideos(this))}setStatus(e,t){switch(t){case 0:e.resourceParent="Tutorial1";break;case 1:e.resourceParent="Tutorial2";break;case 2:e.resourceParent="Tutorial3"}e.status=t,e.elements=e.rm.getElements(e.resourceParent),e.startVideos(e)}startVideos(e){document.getElementById(e.container);for(var t=0;t<e.elements.length;t++)if("video"==e.elements[t].type){var i=document.createElement("video");i.hidden=!0,i.loop=!0,i.muted=!0,i.autoplay=!0,i.playsinline=!0,i.src=e.rm.getResourceUrlBase(e.rm.getSetupResourceId(e.resourceParent,e.elements[t].id,"value")),i.setAttribute("playsinline",""),i.setAttribute("webkit-playsinline",""),i.play(),e.elements[t].videoPlayer=i}}draw(e){for(var t=e.canvas.getContext("2d",{alpha:!1}),i=0;i<e.elements.length;i++){var s={},a=e.drawer.getLayout(e.resourceParent,e.elements[i].id,e.elements[i].type,0,0,"Normal");if(null!=a){e.elements[i].layout=a;var n=e.elements[i].mode,h=!1;if(null!=n){for(var r=n.split("|"),l=0;l<r.length;l++)if(r[l]==mode){h=!0;break}}else h=!0;1==h&&("video"==e.elements[i].type&&(s.player=e.elements[i].videoPlayer),e.drawer.draw(t,a,e.resourceParent,e.elements[i].id,e.elements[i].type,0,0,"Normal",s))}}if(e.debug){var o=1;t.font="12px Verdana",t.fillStyle="gray",t.fillText("Canvas size: "+e.width+"x"+e.height+"px",0,20*o),o++}setTimeout(e.draw,0,e)}getScriptPath(e){var t,i=document.getElementsByTagName("script"),s=0;for(t=0;t<i.length;t++)i[t].src.indexOf(e)>-1&&(s=t);return i[s].src.split("/").slice(0,-1).join("/")+"/"}}FPhi.Tutorial=Tutorial;